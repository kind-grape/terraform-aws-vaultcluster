# - name: Install CA certificates
#   copy:
#     src: etc/vault.d/tls/{{ item }}
#     dest: /etc/vault.d/tls/{{ item }}
#     owner: vault
#     group: vault
#     mode: 0440
#   with_items:
#     - vault-agent-ca.pem
#   no_log: true

- name: Show Vault Telemetry
  debug:
    verbosity: 2
    var: vault_telemtry_enabled

- name: Show Vault Unseal Cloud
  debug:
    verbosity: 2
    var: unseal_cloud

- name: Configure Vault Configuration
  template:
    src: etc/vault.d/vault.hcl.j2
    dest: '/etc/vault.d/vault.hcl'
    owner: 'vault'
    group: 'vault'
    mode: 0660
  register: vault_config

- name: Restart Vault
  service: name=vault state=restarted
  when: vault_config.changed
